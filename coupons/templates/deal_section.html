{% extends 'base.html' %}
{% block meta_title %}{{ meta_title }}{% endblock %}
{% block meta_description %}{{ meta_description }}{% endblock %}
{% block meta_keywords %}{{ meta_keywords }}{% endblock %}

{% block content %}
<!-- Section Header -->
<section class="card-bg rounded-xl shadow-xl overflow-hidden mb-10 border border-blue-700">
    <div class="p-8 md:p-12">
        <div class="max-w-3xl">
            <h1 class="text-4xl md:text-5xl font-bold mb-4 text-gradient">{{ section_title }}</h1>
            <p class="text-xl text-blue-200 mb-6">Discover the best {{ section_title|lower }} from top stores and save money on your purchases.</p>
            <form action="{% url 'search' %}" method="GET" class="flex">
                <input type="text" name="q" placeholder="Search for offers..." class="px-4 py-3 w-full rounded-l-lg bg-black/30 border border-blue-600 text-blue-100 placeholder-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button type="submit" class="btn-gradient text-white px-6 py-3 rounded-r-lg font-semibold hover:opacity-90 transition">Search</button>
            </form>
        </div>
    </div>
</section>

<!-- Section Navigation -->
<section class="mb-8">
    <div class="flex space-x-2 overflow-x-auto scrollbar-hide pb-2">
        <a href="{% url 'deal_section' section='special' %}" class="flex-shrink-0 px-4 py-2 bg-purple-900/50 hover:bg-purple-900/70 text-purple-200 rounded-lg transition flex items-center">
            <i class="fas fa-star mr-2"></i> Special Offers
        </a>
        <a href="{% url 'deal_section' section='amazon' %}" class="flex-shrink-0 px-4 py-2 bg-yellow-900/50 hover:bg-yellow-900/70 text-yellow-200 rounded-lg transition flex items-center">
            <i class="fab fa-amazon mr-2"></i> Amazon Deals
        </a>
        <a href="{% url 'deal_section' section='coupons' %}" class="flex-shrink-0 px-4 py-2 bg-green-900/50 hover:bg-green-900/70 text-green-200 rounded-lg transition flex items-center">
            <i class="fas fa-ticket-alt mr-2"></i> Coupon Codes
        </a>
        <a href="{% url 'deal_section' section='deals' %}" class="flex-shrink-0 px-4 py-2 bg-blue-900/50 hover:bg-blue-900/70 text-blue-200 rounded-lg transition flex items-center">
            <i class="fas fa-tags mr-2"></i> Hot Deals
        </a>
    </div>
</section>




<!-- Offers Grid -->
<div class="offer-list grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
    {% for offer in page_obj %}
    {% include 'offer_card.html' with offer=offer show_expiry=True %}
    {% empty %}
    <div class="col-span-full text-center py-10">
        <p class="text-blue-400">No offers available in this section at the moment.</p>
        <a href="{% url 'home' %}" class="text-blue-300 hover:text-blue-200 mt-4 inline-block">Return to Homepage</a>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
{% if is_paginated %}
<div class="flex justify-center mb-12">
    <nav class="inline-flex rounded-md shadow">
        {% if page_obj.has_previous %}
        <a href="?page=1{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}" class="py-2 px-4 card-bg border border-blue-700 rounded-l-md text-blue-300 hover:bg-blue-900/50">
            <i class="fas fa-angle-double-left"></i>
        </a>
        <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}" class="py-2 px-4 card-bg border-t border-b border-r border-blue-700 text-blue-300 hover:bg-blue-900/50">
            <i class="fas fa-angle-left"></i>
        </a>
        {% endif %}
        
        {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
            <span class="py-2 px-4 btn-gradient border border-blue-700 text-white">{{ num }}</span>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <a href="?page={{ num }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}" class="py-2 px-4 card-bg border-t border-b border-r border-blue-700 text-blue-300 hover:bg-blue-900/50">{{ num }}</a>
            {% endif %}
        {% endfor %}
        
        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}" class="py-2 px-4 card-bg border-t border-b border-r border-blue-700 text-blue-300 hover:bg-blue-900/50">
            <i class="fas fa-angle-right"></i>
        </a>
        <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}" class="py-2 px-4 card-bg border-t border-b border-r border-blue-700 rounded-r-md text-blue-300 hover:bg-blue-900/50">
            <i class="fas fa-angle-double-right"></i>
        </a>
        {% endif %}
    </nav>
</div>
{% endif %}

<!-- Popular Stores -->
<section class="mb-12">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-blue-300">Popular Stores</h2>
        <a href="{% url 'all_stores' %}" class="text-blue-400 hover:text-blue-300 font-medium transition">View All</a>
    </div>
    
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
        {% for store in stores|slice:":12" %}
        {% include 'store_card.html' with store=store %}
        {% empty %}
        <div class="col-span-full text-center py-10">
            <p class="text-blue-400">No stores available.</p>
        </div>
        {% endfor %}
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle filter buttons
    const filterButtons = document.querySelectorAll('.filter-btn');
    
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            const section = this.closest('.filter-controls').dataset.section;
            const sort = this.dataset.sort;
            
            // Update active state
            const container = this.closest('.filter-controls');
            container.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-blue-900/50', 'text-blue-200');
                btn.classList.add('bg-blue-900/30', 'text-blue-300');
            });
            this.classList.remove('bg-blue-900/30', 'text-blue-300');
            this.classList.add('bg-blue-900/50', 'text-blue-200');
            
            // Update URL without page reload
            const url = new URL(window.location);
            url.searchParams.set('sort', sort);
            window.history.pushState({}, '', url);
            
            // Make AJAX request
            fetch(`/filter-offers/?section=${section}&sort=${sort}`)
                .then(response => response.json())
                .then(data => {
                    // Update the offer list
                    const offerList = document.querySelector('.offer-list');
                    offerList.innerHTML = data.html;
                })
                .catch(error => console.error('Error:', error));
        });
    });
});
</script>
{% endblock %}